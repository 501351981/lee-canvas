!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.LeeCanvas=e()}(this,function(){"use strict";var t={backgroundColor:"#ffffff",fontStyle:{x:0,y:0,fontSize:14,fontStyle:"normal",fontWeight:"normal",fontFamily:"PingFangSC-Regular,'Microsoft YaHei',SimSun,Arial,'Helvetica Neue',sans-serif",lineHeight:20,color:"black",marginBottom:10}};var e=function(t){return Object.prototype.toString.call(t)==Object.prototype.toString.call([])},n=function(t){return Object.prototype.toString.call(t)==Object.prototype.toString.call({})},o=function(t){return Object.prototype.toString.call(t)==Object.prototype.toString.call("a")},a="DRAW_IMAGE_TASK",i="DRAW_TEXT_TASK";function r(t,e,n){n.hasOwnProperty("x")&&(t.fontStartX=n.x),n.hasOwnProperty("y")&&(t.fontStartY=n.y);var o=void 0;o=n.hasOwnProperty("width")?n.width:t.canvasWidth-t.fontStartX,t.ctx.font=[n.fontStyle,n.fontWeight,n.fontSize+"px",n.fontFamily].join(" "),t.ctx.fillStyle=n.color,t.ctx.textBaseline="top";for(var a="",i=[],r=0;r<e.length;r++)a+=e[r],(t.ctx.measureText(a).width>=o||r==e.length-1)&&(i.push(a),a="");for(var c=0;c<i.length;c++)t.ctx.fillText(i[c],Math.floor(t.fontStartX),Math.floor(t.fontStartY)),c<i.length-1?t.fontStartY+=n.lineHeight:t.fontStartY+=n.fontSize+n.marginBottom}function c(t,e,n){t.tasks.push({type:e,params:n})}function s(t,c){if(0!=t.tasks.length){var f=t.tasks.shift();if(f)switch(f.type){case a:!function(t,e,n){var o=new Image;o.setAttribute("crossOrigin","Anonymous"),o.src=e.src,o.onload=function(){e.hasOwnProperty("borderRadius")?function(t,e,n,o,a,i,r){var c=Math.min(r,a/2,i/2);t.ctx.save(),t.ctx.beginPath(),t.ctx.moveTo(n,o+c),t.ctx.arcTo(n,o,n+c,o,c),t.ctx.lineTo(n+a-c,o),t.ctx.arcTo(n+a,o,n+a,o+c,c),t.ctx.lineTo(n+a,o+i-c),t.ctx.arcTo(n+a,o+i,n+a-c,o+i,c),t.ctx.lineTo(n+c,o+i),t.ctx.arcTo(n,o+i,n,o+i-c,c),t.ctx.lineTo(n,o+c),t.ctx.clip(),t.ctx.drawImage(e,n,o,a,i),t.ctx.restore()}(t,o,e.x,e.y,e.width,e.height,e.borderRadius):t.ctx.drawImage(o,e.x,e.y,e.width,e.height),"function"==typeof n&&n.call(t)}}(t,f.params,function(){s(t,c)});break;case i:!function(t,a){var i=a.text,c=a.style;if(o(i)){var s=Object.assign({},t.fontStyle,c);r(t,i,s)}else if(e(i))i.forEach(function(e,a){if(o(e)){var i=Object.assign({},t.fontStyle,c);r(t,e,i),0==a&&(delete c.x,delete c.y)}else if(n(e)){var s=Object.assign({},t.fontStyle,c,e);r(t,e.text,s),0==a&&(delete c.x,delete c.y)}});else if(n(i)){var f=Object.assign({},t.fontStyle,c,i);r(t,i.text,f)}}(t,f.params),s(t,c)}}else"function"==typeof c&&c()}function f(t,e){!function(t,e){var n=document.createElement("a");n.href=e,n.download=t.saveFileName,n.click()}(t,function(t,e){return t.canvas.toDataURL(e)}(t,e=function(t){return"image/"+(t=(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|gif/)[0])}(e)))}function l(t,e){if(!(this instanceof l))throw new Error("LeeCanvas 必须通过new关键词进行实例化");this._init(t,e)}return function(e){e.prototype._init=function(e){var n,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=a.backgroundColor,r=a.fontStyle;this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.tasks=new Array,this.fontStyle=r,this.fontStartX=r.x,this.fontStartY=r.y,delete r.x,delete r.y,i&&(o=i,(n=this).ctx.fillStyle=o,n.ctx.fillRect(0,0,n.canvasWidth,n.canvasHeight))}}(l),function(t){t.prototype.addDrawImageTask=function(t){var o=this;if(e(t))t.forEach(function(t){c(o,a,t)});else{if(!n(t))throw new Error("addDrawImageTask 参数只支持对象或数组");c(this,a,t)}}}(l),function(t){t.prototype.addDrawTextTask=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,i,{text:t,style:e})}}(l),function(t){t.prototype.draw=function(){s(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")},t.prototype.getImageData=function(){return this.canvas.toDataURL("image/png")},t.prototype.saveToPng=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lee-canvas";this.saveFileName=t+".png",f(this,"png")},t.prototype.saveToJpeg=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lee-canvas";this.saveFileName=t+".jpeg",f(this,"jpeg")},t.prototype.saveToGif=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lee-canvas";this.saveFileName=t+".gif",f(this,"gif")}}(l),l});
